---
inclusion: always
---

# 开发必读 - 测试与验收规范

## 🚨 核心原则

### 1. 测试优先，禁止裸奔
- ❌ **严禁**未经测试就汇报"完成"
- ❌ **严禁**在生产环境测试
- ✅ **必须**在 debug 环境完成所有测试
- ✅ **必须**通过验收标准才算完成

### 2. TODO 驱动开发
每个开发任务必须：
1. 创建 TODO 文件
2. 定义验收标准
3. 按标准测试
4. 通过后更新状态

## 开发流程

### 第一步：创建 TODO
```markdown
# TODO: [功能名称]

## 需求描述
[清晰描述要实现的功能]

## 验收标准
- [ ] 标准1：具体可测试的条件
- [ ] 标准2：具体可测试的条件
- [ ] 标准3：具体可测试的条件

## 测试环境
- TUI: cicy:tui.0
- API: cicy:api.0

## 状态
- [ ] 开发中
- [ ] 测试中
- [ ] 已完成
```

### 第二步：开发代码
- 在 debug 环境开发
- 使用热重载实时查看效果
- 遵循最小化代码原则

### 第三步：测试验收
**必须在 tmux 窗口中测试：**

1. **启动环境**
```bash
# API 服务器
tmux send-keys -t cicy:api.0 "cd /Users/ton/Desktop/skills/cicy && npm run dev:server" C-m

# TUI 客户端
tmux send-keys -t cicy:tui.0 "cd /Users/ton/Desktop/skills/cicy && npm run dev:tui" C-m
```

2. **逐项测试验收标准**
   - 每个标准必须实际操作验证
   - 记录测试结果
   - 截图或记录输出

3. **测试通过后才能勾选**
```markdown
## 验收标准
- [x] 标准1：✅ 已测试通过
- [x] 标准2：✅ 已测试通过
- [x] 标准3：✅ 已测试通过
```

### 第四步：更新状态
```markdown
## 状态
- [x] 开发中
- [x] 测试中
- [x] 已完成

## 测试记录
- 测试时间：2026-02-11 01:00
- 测试环境：cicy:tui.0 + cicy:api.0
- 测试结果：所有验收标准通过
```

## 验收标准示例

### 示例 1：添加命令功能
```markdown
## 验收标准
- [ ] 在 TUI 输入 `/help` 显示帮助信息
- [ ] 帮助信息包含所有可用命令
- [ ] 按 ESC 可关闭帮助
- [ ] 不影响其他命令功能
```

### 示例 2：修复 Bug
```markdown
## 验收标准
- [ ] Bug 不再出现
- [ ] 原有功能正常工作
- [ ] 没有引入新的错误
- [ ] 在 3 种场景下测试通过
```

### 示例 3：性能优化
```markdown
## 验收标准
- [ ] 响应时间 < 100ms
- [ ] 内存占用 < 50MB
- [ ] CPU 使用率 < 10%
- [ ] 连续运行 10 分钟无异常
```

## 测试检查清单

### 功能测试
- [ ] 正常场景测试
- [ ] 边界条件测试
- [ ] 错误处理测试
- [ ] 用户交互测试

### 集成测试
- [ ] 与现有功能兼容
- [ ] 不影响其他模块
- [ ] API 调用正常
- [ ] 数据流正确

### 回归测试
- [ ] 所有旧功能正常
- [ ] 命令列表完整
- [ ] 快捷键有效
- [ ] 错误提示正确

## AI 助手规则

### 开发任务时必须：
1. ✅ 先创建 TODO 文件
2. ✅ 定义清晰的验收标准
3. ✅ 在 debug 环境测试
4. ✅ 逐项验证验收标准
5. ✅ 全部通过后才汇报完成

### 禁止行为：
1. ❌ 写完代码就说"完成"
2. ❌ 不测试就更新状态
3. ❌ 跳过验收标准
4. ❌ 在生产环境测试
5. ❌ 没有 TODO 就开发

## 汇报模板

### 开始开发
```
📝 已创建 TODO: [功能名称]
📋 验收标准：
  1. [标准1]
  2. [标准2]
  3. [标准3]
🚀 开始开发...
```

### 开发完成，开始测试
```
✅ 代码已完成
🧪 开始测试验收标准...
```

### 测试通过
```
✅ 测试完成
📊 验收结果：
  ✅ 标准1：通过
  ✅ 标准2：通过
  ✅ 标准3：通过
🎉 功能开发完成！
```

### 测试失败
```
❌ 测试失败
📊 验收结果：
  ✅ 标准1：通过
  ❌ 标准2：失败 - [原因]
  ⏸️  标准3：未测试
🔧 继续修复...
```

## 示例：完整开发流程

```markdown
# TODO: 添加 /help 命令

## 需求描述
在 TUI 客户端添加 /help 命令，显示所有可用命令的帮助信息。

## 验收标准
- [ ] 输入 `/help` 显示帮助弹窗
- [ ] 帮助内容包含所有命令
- [ ] 按 ESC 关闭帮助
- [ ] 不影响其他命令

## 开发步骤
1. 在 client-tui.js 添加 help 命令处理
2. 创建帮助弹窗组件
3. 添加到命令列表

## 测试记录

### 测试 1：显示帮助
- 操作：在 TUI 输入 `/help`
- 预期：显示帮助弹窗
- 结果：✅ 通过

### 测试 2：帮助内容
- 操作：查看帮助内容
- 预期：包含所有命令
- 结果：✅ 通过

### 测试 3：关闭帮助
- 操作：按 ESC
- 预期：帮助关闭，回到输入框
- 结果：✅ 通过

### 测试 4：其他命令
- 操作：测试 /quit, /list, /clear
- 预期：所有命令正常
- 结果：✅ 通过

## 状态
- [x] 开发中
- [x] 测试中
- [x] 已完成

## 完成时间
2026-02-11 01:15
```

## 记住

> **没有测试 = 没有完成**
> 
> **没有验收 = 没有交付**
> 
> **质量第一，速度第二**
